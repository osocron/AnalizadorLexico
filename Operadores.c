//
// Created by Eduardo on 9/25/2016.
//

#include "Operadores.h"
#include "FileUtils.h"

#define ESTADO_OPE 42 //Estados del automata
#define CODIGO_OPE 17 //Códigos o simbolos de entrada

int lexico_ope(long int *init, char *nombreArchivoEntrada){
    unsigned int codigo;
    unsigned int salida=0, estado=0;

    static unsigned int matriz_transicion_operadores[ESTADO_OPE][CODIGO_OPE]={
            //  .   -   >   +   &   *   ~   !   /   %   <   =   ^   |   ?   #   Otro
            {1,  3, 27,  8, 11, 14, 16, 17, 19, 21, 23, 31, 33, 35, 37, 39, 41},
            {0,  0,  0,  0,  0,  2,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},
            {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},
            {0,  5,  4,  0,  0,  0,  0,  0,  0,  0,  0,  6,  0,  0,  0,  0,  0},
            {0,  0,  0,  0,  0,  7,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},
            {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},
            {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},
            {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},
            {0,  0,  0,  9,  0,  0,  0,  0,  0,  0,  0, 10,  0,  0,  0,  0,  0},
            {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},
            {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},
            {0,  0,  0,  0, 12,  0,  0,  0,  0,  0,  0, 13,  0,  0,  0,  0,  0},
            {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},
            {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},
            {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 15,  0,  0,  0,  0,  0},
            {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},
            {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},
            {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 18,  0,  0,  0,  0,  0},
            {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},
            {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 20,  0,  0,  0,  0,  0},
            {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},
            {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 22,  0,  0,  0,  0,  0},
            {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},
            {0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 24, 26,  0,  0,  0,  0,  0},
            {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 25,  0,  0,  0,  0,  0},
            {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},
            {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},
            {0,  0, 28,  0,  0,  0,  0,  0,  0,  0,  0, 30,  0,  0,  0,  0,  0},
            {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 29,  0,  0,  0,  0,  0},
            {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},
            {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},
            {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 32,  0,  0,  0,  0,  0},
            {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},
            {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 34,  0,  0,  0,  0,  0},
            {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},
            {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 36,  0,  0,  0},
            {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},
            {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 38,  0,  0,  0,  0,  0},
            {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},
            {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 40,  0},
            {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},
            {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0}
    };

    static unsigned int matriz_salida_operadores[ESTADO_OPE][CODIGO_OPE]= {
            //  .   -   >   +   &   *   ~   !   /   %   <   =   ^   |   ?   #   Otro
            { 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0}, //Estado inicial
            { 1,  1,  1,  1,  1,  0,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1}, // .
            { 2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2}, // .*
            { 3,  0,  0,  3,  3,  3,  3,  3,  3,  3,  3,  0,  3,  3,  3,  3,  3}, // -
            { 4,  4,  4,  4,  4,  0,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4}, // ->
            { 5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5}, // --
            { 6,  6,  6,  6,  6,  6,  6,  6,  6,  6,  6,  6,  6,  6,  6,  6,  6}, // -=
            { 7,  7,  7,  7,  7,  7,  7,  7,  7,  7,  7,  7,  7,  7,  7,  7,  7}, // ->*
            { 8,  8,  8,  0,  8,  8,  8,  8,  8,  8,  8,  0,  8,  8,  8,  8,  8}, // +
            { 9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9}, // ++
            {10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10}, // +=
            {11, 11, 11, 11, 0,  11, 11, 11, 11, 11, 11,  0, 11, 11, 11, 11, 11}, // &
            {12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12}, // &&
            {13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13}, // &=
            {14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14,  0, 14, 14, 14, 14, 14}, // *
            {15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15}, // *=
            {16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16}, // ~
            {17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17,  0, 17, 17, 17, 17, 17}, // !
            {18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18}, // !=
            {19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19,  0, 19, 19, 19, 19, 19}, // /
            {20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20}, // /=
            {21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21,  0, 21, 21, 21, 21, 21}, // %
            {22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22}, // %=
            {23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 0,   0, 23, 23, 23, 23, 23}, // <
            {24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,  0, 24, 24, 24, 24, 24}, // <<
            {25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25}, // <<=
            {26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26}, // <=
            {27, 27,  0, 27, 27, 27, 27, 27, 27, 27, 27,  0, 27, 27, 27, 27, 27}, // >
            {28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28,  0, 28, 28, 28, 28, 28}, // >>
            {29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29}, // >>=
            {30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30}, // >=
            {31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31,  0, 31, 31, 31, 31, 31}, // =
            {32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32}, // ==
            {33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33,  0, 33, 33, 33, 33, 33}, // ^
            {34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34}, // ^=
            {35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 0,  35, 35, 35}, // |
            {36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36}, // ||
            {37, 37, 37, 37, 37, 37, 37, 37, 37, 37, 37,  0, 37, 37, 37, 37, 37}, // ?
            {38, 38, 38, 38, 38, 38, 38, 38, 38, 38, 38, 38, 38, 38, 38, 38, 38}, // ?=
            {39, 39, 39, 39, 39, 39, 39, 39, 39, 39, 39, 39, 39, 39, 39,  0, 39}, // #
            {40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40}, // ##
            {41, 41, 41, 41, 41, 41, 41, 41, 41, 41, 41, 41, 41, 41, 41, 41, 41} // Salida rápida
    };

    while (salida==0){
        codigo= filtro_ope(init, nombreArchivoEntrada);
        salida= matriz_salida_operadores[estado][codigo];
        estado= matriz_transicion_operadores[estado][codigo];
    }

    return salida;
}

unsigned int filtro_ope(long int *init, char *nombreArchivoEntrada){
    char buff[1];
    *init= getNChars(buff, 1, *init, nombreArchivoEntrada);
    if(buff[0]=='.')
        return 0;
    else if(buff[0]=='-')
        return 1;
    else if(buff[0]=='>')
        return 2;
    else if(buff[0]=='+')
        return 3;
    else if(buff[0]=='&')
        return 4;
    else if(buff[0]=='*')
        return 5;
    else if(buff[0]=='~')
        return 6;
    else if(buff[0]=='!')
        return 7;
    else if(buff[0]=='/')
        return 8;
    else if(buff[0]=='%')
        return 9;
    else if(buff[0]=='<')
        return 10;
    else if(buff[0]=='=')
        return 11;
    else if(buff[0]=='^')
        return 12;
    else if(buff[0]=='|')
        return 13;
    else if(buff[0]=='?')
        return 14;
    else if(buff[0]=='#')
        return 15;
    else
        return 16;
}

